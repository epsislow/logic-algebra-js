<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tester</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" />

  <!--link rel="stylesheet" href="/ext/fontawesome.5.0.13.css"/-->

  <!--link rel="stylesheet" href="/ext/bootstrap.4.0.0.css"/-->

  <style>

    .bg-black {
      background-color: #000;
    }
    .button {
      margin-right: 5px;
      padding: 2px;
    }
    .bg-darkcyan {
      background-color: #005555;
    }
    .bg-util {
      background-color: #552d17;
    }

  </style>
</head>

<body class="bg-black">
<main role="main" class="container">
  Tester
</main><!-- /.container -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<!--script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

<!--script src="/ext/jQuery.3.2.1.js" type="text/javascript"></script-->

<!--script src="/ext/popper.js" type="text/javascript"></script-->

<!--script src="/ext/bootstrap.4.0.0.js" type="text/javascript"></script-->

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

<script type="text/javascript" src="/library/Visual.js"></script>

<script type="text/javascript" src="/library/sha1/Random.js"></script>

<script type="module">
  import { NBQueue2 } from '/library/modules/NBQueue.js'

  window.queue = NBQueue2;
  var ra;
     
window.onerror = function (message, url, line, column, error) {
    console.log(message, url, line, column, error);
    alert(message+' L'+line+':'+column);
}

  $('document').ready(function() {

    if('vs' in window) {

      vs.page('Gam2');

      ra = vs.clearBody()
              .section('top')
              .br()
              .addButton('Index', '/index.html')
              .br()
              .container('main','div');

      vs.addSectionsToMain();
      gam2.init();
    }
  });

  window.gam2 = {
    'money': 0,
    'res': [],
    'building': [],
    'util': [],
    'menu':[],
    'addRes': function (name, amount = 0, unitValue = 0) {
        this.res.push({
          title: 'Resource',
          name: name,
          description:  'Used as coin',
          amount: amount,
          unitValue: unitValue,
        });
    },
    'addCraft': function (to, name, resMax = 1, ques=1) {
      to.push({
        title: 'Crafter',
        name: name,
        description:  'Craft items',
        resMax: resMax,
        queues: ques,
      });
    },
    'addSmelt': function (to, name, ques=1) {
      to.push({
        title: 'Smelter',
        name: name,
        description:  'Smelt items',
        queues: ques,
      });
    },
    'addMenu': function(name) {
      if(name==='util') {
        this.addSmelt(this.menu, 'Smelter 1');
        this.addCraft(this.menu, 'Crafter 1');
      }
    },
      'init': function () {
        this.addRes('Galvinum', 10, 5);
        this.addRes('Soltzis', 25, 10);
        this.show();
      },
      'actions': {
        'mine': function (resId) {
          //console.log('mine' + resId);
          //setTimeout(function () {
          gam2.res[resId].amount++;
          ra.clear();
          gam2.show();
          //}, 1000);
        },
        'sell': function (resId, amount = -1) {
          amount = amount<0? gam2.res[resId].amount: amount;
          gam2.res[resId].amount-= amount;
          gam2.money+=gam2.res[resId].unitValue * amount;
          //console.log('sell' + resId + ' ' +  amount);
          ra.clear();
          gam2.show();
        },
        'search':function () {
          console.log('search');
        },
        'build':function() {
          gam2.addMenu('util');
          ra.clear();
          gam2.show();
        },
        'selectMenu': function(to, util) {
          to.push(util);
          gam2.menu= [];
          ra.clear();
          gam2.show();
        },
      },
      'show': function () {
        var box;
        ra.container('m-2 p-3 bg-black rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px; border: 1px solid #fff')
                .container('border-bottom border-gray pb-2 mb-0', 'h6')
                .addText('$')
                .up()
                .container('media text-muted pt-2')
                .container('media-body ml-2 mb-0 small lh-125', 'p')
                .container('d-block text-light', 'strong')
                .addText('Money')
                .up()
                .addText('Amount: ' + this.money)
                .br() 
                .br();

        for(var r in this.res) {
          box = this.res[r];
          var ra2 = ra.container('m-2 p-3 bg-dark rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px')
                  .container('border-bottom border-gray pb-2 mb-0', 'h6')
                  .addText(box.title)
                  .up()
                  .container('media text-muted pt-2')
                  .container('media-body ml-2 mb-0 small lh-125', 'p')
                  .container('d-block text-light', 'strong')
                  .addText(box.name)
                  .up()
                  .addText('Amount: ' + box.amount)
                  .br()
                  .addText('Value: ' + box.unitValue * box.amount +'$')
                  .br()
                  .br();


          if (box.title === 'Resource') {
            ra2.addButton('Mine', (function(opt) { return function() { gam2.actions.mine(opt) };})(r), 'btn-success button')
                .addButton('Sell 1', (function(opt) { return function() { gam2.actions.sell(opt,1) };})(r), 'btn-warning button')
                .addButton('Sell All', (function(opt) { return function() { gam2.actions.sell(opt) };})(r), 'btn-danger button');
          }
        }
        
        if(this.menu.length==0) {
        }
        
        for(var m in this.util) {
        box= this.util[m];
        ra.container('m-2 p-3 bg-util rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px;')
        .container('border-bottom border-gray pb-2 mb-0', 'h6')
        .addText(box.title)
        .up()
        .container('media text-muted pt-2')
        .container('media-body ml-2 mb-0 small lh-125', 'p')
        .container('d-block text-light', 'strong')
        .addText(box.name)
        .up()
        .addText(box.description)
        .br()
        .br()
        .br()
        .addButton('Resource', false, 'btn-warning button')
        ;
        }
        
        if(this.menu.length==0) {
        
                ra.container('m-2 p-3 bg-darkcyan rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px; border-style: dashed')
                .container('border-bottom border-gray pb-2 mb-0', 'h6')
                .addText('+1 Resource')
                .up()
                .container('media text-muted pt-2')
                .container('media-body ml-2 mb-0 small lh-125', 'p')
                .container('d-block text-light', 'strong')
                .addText('Up for more?')
                .up()
                .br()
                .br()
                .br()
                .addButton('Search', gam2.actions.search, 'btn-light button')
                ;

          ra.container('m-2 p-3 bg-util rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px; border-style: dashed')
          .container('border-bottom border-gray pb-2 mb-0', 'h6')
          .addText('+1 Utility')
          .up()
          .container('media text-muted pt-2')
          .container('media-body ml-2 mb-0 small lh-125', 'p')
          .container('d-block text-light', 'strong')
          .addText('Need an utility?')
          .up()
          .br()
          .br()
          .br()
          .addButton('Build', gam2.actions.build, 'btn-light button')
          ;
        } else {
          for(var m in this.menu) {
            box= this.menu[m];
            ra.container('m-2 p-3 bg-black rounded box-shadow text-light', 'div', 'float:left;width:170px; height: 160px; border-style: dashed')
            .container('border-bottom border-gray pb-2 mb-0', 'h6')
            .addText(box.title)
            .up()
            .container('media text-muted pt-2')
            .container('media-body ml-2 mb-0 small lh-125', 'p')
            .container('d-block text-light', 'strong')
            .addText(box.name)
            .up()
            .addText(box.description)
            .br()
            .br()
            .br()
            .addButton('Select',
              (function(to,w) { return function() { gam2.actions.selectMenu(to,w) };})(gam2.util, box),
              'btn-light button'
            )
            ;
          }
        }
      }
  };
</script>
</body>
</html>